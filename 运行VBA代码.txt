;功能说明:将vba代码写入到模块中，然后运行。结束后删除模块。

F6::
VbaExcel :=Excel_Get()
VbaCode=
(
Sub 测试()
'Application.ScreenUpdating = False
'Application.DisplayAlerts = False
 MsgBox "这是测试命令"
End Sub
)
VBE_RUN(VbaCode,"测试")
VbaExcel=
return


;将VBA代码添加到新建模块中，并运行。运行完成后将移除VBA模块
VBE_Run(VBcode,MacroName){
global VbaExcel
TimeName :=A_Now		;以时间命名以防重复
try{
	VbaExcel.ActiveWorkbook.VBProject.VBComponents.Add(1).Name :="CXH_" TimeName	;新建模块
}catch
{
	VbaExcel.ScreenUpdating := -1
	Gui +OwnDialogs
	MsgBox,遇到错误,可能原因如下:`n1.检查是否支持VBA环境`n2.宏安全设置不允许对代码进行操作,请设置信任中心,勾选信任对“Visual Basic 项目”的访问`n3.其他
	return
}
oVBComponent :=VbaExcel.ActiveWorkbook.VBProject.VBComponents.Item("CXH_" TimeName)	;新模块对象
try{
	oVBComponent.CodeModule.InsertLines(1, VBcode)		;添加代码到模块
	VbaExcel.Run("CXH_" TimeName "." . MacroName)			;运行模块函数
}catch
{
	try{
		VbaExcel.ActiveWorkbook.VBProject.VBComponents.Remove(oVBComponent)		;如果遇到错误，则删除模块
	}
	VbaExcel.ScreenUpdating := -1
	return
}
try{
	VbaExcel.ActiveWorkbook.VBProject.VBComponents.Remove(oVBComponent)		;删除模块
}
	VbaExcel.ScreenUpdating := -1
return
}